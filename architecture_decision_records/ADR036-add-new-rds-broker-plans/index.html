<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>ADR036 - Recommended database plans - PaaS Team Manual</title>

    <link href="../../stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://team-manual.cloud.service.gov.uk/architecture_decision_records/ADR036-add-new-rds-broker-plans/">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="team-manual.cloud.service.gov.uk" />
      <meta name="twitter:image" content="https://team-manual.cloud.service.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="ADR036 - Recommended database plans - PaaS Team Manual" />
      <meta name="twitter:url" content="https://team-manual.cloud.service.gov.uk/architecture_decision_records/ADR036-add-new-rds-broker-plans/" />

      <meta property="og:image" content="https://team-manual.cloud.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="PaaS Team Manual" />
      <meta property="og:title" content="ADR036 - Recommended database plans" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://team-manual.cloud.service.gov.uk/architecture_decision_records/ADR036-add-new-rds-broker-plans/" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="https://team-manual.cloud.service.gov.uk" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          PaaS Team Manual
        </span>
      </a>
        <strong class="govuk-tag">Internal</strong>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents" role="dialog">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://team-manual.cloud.service.gov.uk"/>
    <label class="govuk-label search__label" for="search" aria-hidden="true">
      Search (via Google)
    </label>
    <input
      type="text"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
  <div id="search-results" class="search-results" aria-hidden="true" role="dialog" aria-labelledby="search-results-title">
    <div class="search-results__inner">
      <button class="search-results__close">Close<span class="search-results__close-label"> search results</span></button>
      <h2 id="search-results-title" class="search-results__title" aria-live="assertive" role="alert">Results</h2>
      <div class="search-results__content"></div>
    </div>
  </div>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                      <ul>
  <li>
    <a href="#adr036-recommended-database-plans"><span>ADR036: Recommended database plans</span></a>
    <ul>
      <li>
        <a href="#context"><span>Context</span></a>
        <ul>
          <li>
            <a href="#current-plans"><span>Current plans</span></a>
            <ul>
              <li>
                <a href="#mysql"><span>MySql</span></a>
              </li>
              <li>
                <a href="#postgres"><span>Postgres</span></a>
              </li>
            </ul>
          </li>
          <li>
            <a href="#current-analysis"><span>Current analysis</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#decision"><span>Decision</span></a>
        <ul>
          <li>
            <a href="#create-new-plans-for-postgres-11"><span>Create new plans for postgres 11</span></a>
          </li>
          <li>
            <a href="#create-new-plans-for-mysql-8"><span>Create new plans for mysql 8</span></a>
          </li>
          <li>
            <a href="#create-new-quot-small-high-iops-quot-and-quot-small-ha-high-iops-quot-plans-for-mysql-5-7-postgres-9-5-and-10"><span>Create new “small-high-iops” and “small-ha-high-iops” plans, for mysql 5.7, postgres 9.5 and 10</span></a>
          </li>
          <li>
            <a href="#do-not-change-the-instance-types-for-the-existing-plans"><span>Do not change the instance types for the existing plans</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#status"><span>Status</span></a>
      </li>
      <li>
        <a href="#consequences"><span>Consequences</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              <div class="page-banner">
    <p>This is for internal use by the PaaS team. Public-facing documentation is located at <a href="https://docs.cloud.service.gov.uk">docs.cloud.service.gov.uk</a>.</p>
  </div>

  <h1 id="adr036-recommended-database-plans">ADR036: Recommended database plans</h1><p>==========================</p>

<!-- vim: set tw=100: -->
<h2 id="context">Context</h2><h3 id="current-plans">Current plans</h3><p>As of 2019-09-03 <a href="https://cloud.service.gov.uk">GOV.UK PaaS</a> offers the following postgres and mysql
plans to everyone:</p>
<h4 id="mysql">MySql</h4><div class="table-container">
        <table>
          <tr>
<th>service plan</th>
<th>description</th>
<th>free or paid</th>
</tr><tr>
<th scope="row">tiny-unencrypted-5.7</th>
<td>5GB Storage, NOT BACKED UP, Dedicated Instance. MySQL Version 5.7. DB Instance Class: db.t2.micro.</td>
<td>free</td>
</tr><tr>
<th scope="row">medium-ha-5.7</th>
<td>100GB Storage, Dedicated Instance, Highly Available, Storage Encrypted. MySQL Version 5.7. DB Instance Class: db.m4.large.</td>
<td>paid</td>
</tr><tr>
<th scope="row">large-ha-5.7</th>
<td>512GB Storage, Dedicated Instance, Highly Available, Storage Encrypted. MySQL Version 5.7. DB Instance Class: db.m4.2xlarge.</td>
<td>paid</td>
</tr><tr>
<th scope="row">xlarge-ha-5.7</th>
<td>2TB Storage, Dedicated Instance, Highly Available, Storage Encrypted. MySQL Version 5.7. DB Instance Class: db.m4.4xlarge.</td>
<td>paid</td>
</tr><tr>
<th scope="row">small-ha-5.7</th>
<td>20GB Storage, Dedicated Instance, Highly Available. Storage Encrypted. MySQL Version 5.7. DB Instance Class: db.t2.small.</td>
<td>paid</td>
</tr><tr>
<th scope="row">small-5.7</th>
<td>20GB Storage, Dedicated Instance, Storage Encrypted. MySQL Version 5.7. DB Instance Class: db.t2.small.</td>
<td>paid</td>
</tr><tr>
<th scope="row">medium-5.7</th>
<td>100GB Storage, Dedicated Instance, Storage Encrypted. MySQL Version 5.7. DB Instance Class: db.m4.large.</td>
<td>paid</td>
</tr><tr>
<th scope="row">large-5.7</th>
<td>512GB Storage, Dedicated Instance, Storage Encrypted. MySQL Version 5.7. DB Instance Class: db.m4.2xlarge.</td>
<td>paid</td>
</tr><tr>
<th scope="row">xlarge-5.7</th>
<td>2TB Storage, Dedicated Instance, Storage Encrypted. MySQL Version 5.7. DB Instance Class: db.m4.4xlarge.</td>
<td>paid</td>
</tr>
        </table>
      </div><h4 id="postgres">Postgres</h4><div class="table-container">
        <table>
          <tr>
<th>service plan</th>
<th>description</th>
<th>free or paid</th>
</tr><tr>
<th scope="row">tiny-unencrypted-9.5</th>
<td>5GB Storage, NOT BACKED UP, Dedicated Instance, Max 50 Concurrent Connections. Postgres Version 9.5. DB Instance Class: db.t2.micro.</td>
<td>free</td>
</tr><tr>
<th scope="row">medium-ha-9.5</th>
<td>100GB Storage, Dedicated Instance, Highly Available, Storage Encrypted, Max 500 Concurrent Connections. Postgres Version 9.5. DB Instance Class: db.m4.large.</td>
<td>paid</td>
</tr><tr>
<th scope="row">large-ha-9.5</th>
<td>512GB Storage, Dedicated Instance, Highly Available, Storage Encrypted, Max 5000 Concurrent Connections. Postgres Version 9.5. DB Instance Class: db.m4.2xlarge.</td>
<td>paid</td>
</tr><tr>
<th scope="row">xlarge-ha-9.5</th>
<td>2TB Storage, Dedicated Instance, Highly Available, Storage Encrypted, Max 5000 Concurrent Connections. Postgres Version 9.5. DB Instance Class: db.m4.4xlarge.</td>
<td>paid</td>
</tr><tr>
<th scope="row">small-ha-9.5</th>
<td>20GB Storage, Dedicated Instance, Highly Available, Storage Encrypted, Max 200 Concurrent Connections. Postgres Version 9.5. DB Instance Class: db.t2.small.</td>
<td>paid</td>
</tr><tr>
<th scope="row">small-9.5</th>
<td>20GB Storage, Dedicated Instance, Storage Encrypted, Max 200 Concurrent Connections. Postgres Version 9.5. DB Instance Class: db.t2.small.</td>
<td>paid</td>
</tr><tr>
<th scope="row">medium-9.5</th>
<td>100GB Storage, Dedicated Instance, Storage Encrypted, Max 500 Concurrent Connections. Postgres Version 9.5. DB Instance Class: db.m4.large.</td>
<td>paid</td>
</tr><tr>
<th scope="row">large-9.5</th>
<td>512GB Storage, Dedicated Instance, Storage Encrypted, Max 5000 Concurrent Connections. Postgres Version 9.5. DB Instance Class: db.m4.2xlarge.</td>
<td>paid</td>
</tr><tr>
<th scope="row">xlarge-9.5</th>
<td>2TB Storage, Dedicated Instance, Storage Encrypted, Max 5000 Concurrent Connections. Postgres Version 9.5. DB Instance Class: db.m4.4xlarge.</td>
<td>paid</td>
</tr><tr>
<th scope="row">tiny-unencrypted-10</th>
<td>5GB Storage, NOT BACKED UP, Dedicated Instance, Max 50 Concurrent Connections. Postgres Version 10. DB Instance Class: db.t2.micro.</td>
<td>free</td>
</tr><tr>
<th scope="row">small-10</th>
<td>20GB Storage, Dedicated Instance, Storage Encrypted, Max 200 Concurrent Connections. Postgres Version 10. DB Instance Class: db.t2.small.</td>
<td>paid</td>
</tr><tr>
<th scope="row">small-ha-10</th>
<td>20GB Storage, Dedicated Instance, Highly Available, Storage Encrypted, Max 200 Concurrent Connections. Postgres Version 10. DB Instance Class: db.t2.small.</td>
<td>paid</td>
</tr><tr>
<th scope="row">medium-10</th>
<td>100GB Storage, Dedicated Instance, Storage Encrypted, Max 500 Concurrent Connections. Postgres Version 10. DB Instance Class: db.m4.large.</td>
<td>paid</td>
</tr><tr>
<th scope="row">medium-ha-10</th>
<td>100GB Storage, Dedicated Instance, Highly Available, Storage Encrypted, Max 500 Concurrent Connections. Postgres Version 10. DB Instance Class: db.m4.large.</td>
<td>paid</td>
</tr><tr>
<th scope="row">large-10</th>
<td>512GB Storage, Dedicated Instance, Storage Encrypted, Max 5000 Concurrent Connections. Postgres Version 10. DB Instance Class: db.m4.2xlarge.</td>
<td>paid</td>
</tr><tr>
<th scope="row">large-ha-10</th>
<td>512GB Storage, Dedicated Instance, Highly Available, Storage Encrypted, Max 5000 Concurrent Connections. Postgres Version 10. DB Instance Class: db.m4.2xlarge.</td>
<td>paid</td>
</tr><tr>
<th scope="row">xlarge-10</th>
<td>2TB Storage, Dedicated Instance, Storage Encrypted, Max 5000 Concurrent Connections. Postgres Version 10. DB Instance Class: db.m4.4xlarge.</td>
<td>paid</td>
</tr><tr>
<th scope="row">xlarge-ha-10</th>
<td>2TB Storage, Dedicated Instance, Highly Available, Storage Encrypted, Max 5000 Concurrent Connections. Postgres Version 10. DB Instance Class: db.m4.4xlarge.</td>
<td>paid</td>
</tr>
        </table>
      </div><h3 id="current-analysis">Current analysis</h3><p>In <a href="https://www.pivotaltracker.com/n/projects/1275640/stories/167839682">#167839682</a> we had a look
at the usage on our existing databases and concluded that, for the most part, the existing plans are
appropriate for current usage. We didn&rsquo;t identify any databases that could easily have been on a
smaller instance size if only it had higher IOPS (which was one hypothesis).</p>
<p>There was some evidence in the form of support tickets that our current small plans don&rsquo;t have
enough IOPS, causing people to prematurely upgrade to mediums.  AWS warn you against creating DBs
with less than 100G disk due to IOPS restrictions, so it seems sensible that we shouldn&rsquo;t provided
plans smaller than that.</p>
<p>At the moment, prices for postgres 10.5 Tiny, Small and Medium instances are:</p>
<div class="table-container">
        <table>
          <tr>
<th>plan</th>
<th>price / month</th>
</tr><tr>
<th scope="row">tiny</th>
<td>£12.03</td>
</tr><tr>
<th scope="row">small</th>
<td>£24.50</td>
</tr><tr>
<th scope="row">small-ha</th>
<td>£48.98</td>
</tr><tr>
<th scope="row">medium</th>
<td>£125.94</td>
</tr><tr>
<th scope="row">medium-ha</th>
<td>£251.79</td>
</tr>
        </table>
      </div><p>If we were to increase the disk size on small instances from the current 2G to 100G, this would
cause the small plans to increase roughly as follows (based on Ireland prices):</p>
<div class="table-container">
        <table>
          <tr>
<th>plan</th>
<th>price / month</th>
</tr><tr>
<th scope="row">tiny</th>
<td>£12.03</td>
</tr><tr>
<th scope="row">small</th>
<td>£34.40 (was £24.50)</td>
</tr><tr>
<th scope="row">small-ha</th>
<td>£67.88 (was £48.98)</td>
</tr><tr>
<th scope="row">medium</th>
<td>£125.94</td>
</tr><tr>
<th scope="row">medium-ha</th>
<td>£251.79</td>
</tr>
        </table>
      </div><p>We have about 100 &ldquo;small&rdquo; databases, of which 28 are HA and 70 are not. This means if we changed the
disk on the existing plans our tenants would have to pay an extra £1,200/month (but on the flip
side, they might be able to stick with small plans for longer, because of the better IOPS).</p>
<p>Alternatively we could add a new pair of plans like &ldquo;small-high-iops&rdquo; and &ldquo;small-ha-high-iops&rdquo;.
This would allow an upgrade path of <code>small -&gt; small-high-iops -&gt; medium</code>, instead of the current
<code>small -&gt; medium</code>, which would avoid people paying for CPU and memory they don&rsquo;t need.</p>
<p>Separately, we should add support for postgres 11 and mysql 8, which are both supported by RDS now.
For these new plans we should use the newest available instance types (so t3 / m5 instead of t2 /
m4).</p>
<h2 id="decision">Decision</h2><h3 id="create-new-plans-for-postgres-11">Create new plans for postgres 11</h3><p>We should play <a href="https://www.pivotaltracker.com/story/show/168322288">a story to add the following new plans</a>:</p>
<div class="table-container">
        <table>
          <tr>
<th>service plan</th>
<th>summary</th>
</tr><tr>
<th scope="row">tiny-unencrypted-11</th>
<td>5GB Storage, NOT BACKED UP. DB Instance Class: db.t3.micro.</td>
</tr><tr>
<th scope="row">small-11</th>
<td>100GB Storage. DB Instance Class: db.t3.small.</td>
</tr><tr>
<th scope="row">small-ha-11</th>
<td>100GB Storage. DB Instance Class: db.t3.small.</td>
</tr><tr>
<th scope="row">medium-11</th>
<td>100GB Storage. DB Instance Class: db.m5.large.</td>
</tr><tr>
<th scope="row">medium-ha-11</th>
<td>100GB Storage. DB Instance Class: db.m5.large.</td>
</tr><tr>
<th scope="row">large-11</th>
<td>512GB Storage. DB Instance Class: db.m5.2xlarge.</td>
</tr><tr>
<th scope="row">large-ha-11</th>
<td>512GB Storage. DB Instance Class: db.m5.2xlarge.</td>
</tr><tr>
<th scope="row">xlarge-11</th>
<td>2TB Storage. DB Instance Class: db.m5.4xlarge.</td>
</tr><tr>
<th scope="row">xlarge-ha-11</th>
<td>2TB Storage. DB Instance Class: db.m5.4xlarge.</td>
</tr>
        </table>
      </div><p>(note: t3 / m5 instances, small plans have 100G storage instead of 20G)</p>
<h3 id="create-new-plans-for-mysql-8">Create new plans for mysql 8</h3><p>We should play <a href="https://www.pivotaltracker.com/story/show/168322475">a story to add the following new plans</a>:</p>
<div class="table-container">
        <table>
          <tr>
<th>service plan</th>
<th>summary</th>
</tr><tr>
<th scope="row">tiny-unencrypted-8</th>
<td>5GB Storage. DB Instance Class: db.t3.micro.</td>
</tr><tr>
<th scope="row">small-8</th>
<td>100GB Storage. DB Instance Class: db.t3.small.</td>
</tr><tr>
<th scope="row">small-ha-8</th>
<td>100GB Storage. DB Instance Class: db.t3.small.</td>
</tr><tr>
<th scope="row">medium-8</th>
<td>100GB Storage. DB Instance Class: db.m5.large.</td>
</tr><tr>
<th scope="row">medium-ha-8</th>
<td>100GB Storage. DB Instance Class: db.m5.large.</td>
</tr><tr>
<th scope="row">large-8</th>
<td>512GB Storage. DB Instance Class: db.m5.2xlarge.</td>
</tr><tr>
<th scope="row">large-ha-8</th>
<td>512GB Storage. DB Instance Class: db.m5.2xlarge.</td>
</tr><tr>
<th scope="row">xlarge-8</th>
<td>2TB Storage. DB Instance Class: db.m5.4xlarge.</td>
</tr><tr>
<th scope="row">xlarge-ha-8</th>
<td>2TB Storage. DB Instance Class: db.m5.4xlarge.</td>
</tr>
        </table>
      </div><p>(note: t3 / m5 instances, small plans have 100G storage instead of 20G)</p>
<h3 id="create-new-quot-small-high-iops-quot-and-quot-small-ha-high-iops-quot-plans-for-mysql-5-7-postgres-9-5-and-10">Create new &ldquo;small-high-iops&rdquo; and &ldquo;small-ha-high-iops&rdquo; plans, for mysql 5.7, postgres 9.5 and 10</h3><p>We should play <a href="https://www.pivotaltracker.com/story/show/168322617">a story to add &ldquo;High IOPS&rdquo; plans for the existing postgres / mysql versions</a>.</p>
<p>These should have 100G of storage and be on the <code>t3.small</code> instance type (since there&rsquo;s no reason to
be adding new plans on old instance types).</p>
<p>This story may turn out not to be a priority.</p>
<h3 id="do-not-change-the-instance-types-for-the-existing-plans">Do not change the instance types for the existing plans</h3><p>We considered whether to upgrade existing databases to new m5 / t3 instances, or to make it so that
new databases on old versions (i.e. postgres 9.5 / 10, mysql 5.7) get latest-generation instance
types.</p>
<p>We decided not to do this because it would be tricky to administer the change, and it&rsquo;s nice to have
the new instance types as an incentive for people to upgrade.</p>
<h2 id="status">Status</h2><p>Accepted</p>
<h2 id="consequences">Consequences</h2>
<ul>
<li>Small databases for the newer engine versions (postgres 11 / mysql 8) will be more expensive and
have more disk.</li>
<li>Some tenants may be able to stick with small databases for longer before they have to upgrade to
the medium plan, saving them money.</li>
<li>Tenants will be able to get higher performing databases by using the newest engine versions
(postgres 11 / mysql 8).</li>
<li>It will be possible for us to implement &ldquo;downgrading&rdquo; from <code>medium</code> to <code>small</code> databases for the
new plans in the broker (since they have the same sized disks) - this could save tenants money if
they optimise their database usage and discover they could move from a <code>medium</code> to a <code>small</code>.</li>
<li>We will have 9 to 11 more plans for postgres and mysql.</li>
</ul>


            
          </main>

          <aside>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="../../accessibility/">Accessibility</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="../../javascripts/application.js"></script>
  </body>
</html>

<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Prometheus - PaaS Team Manual</title>

    <link href="/stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://team-manual.cloud.service.gov.uk/technical_design/prometheus/">

      <meta name="robots" content="noindex" />
      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="team-manual.cloud.service.gov.uk" />
      <meta name="twitter:image" content="https://team-manual.cloud.service.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="Prometheus - PaaS Team Manual" />
      <meta name="twitter:url" content="https://team-manual.cloud.service.gov.uk/technical_design/prometheus/" />

      <meta property="og:image" content="https://team-manual.cloud.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="PaaS Team Manual" />
      <meta property="og:title" content="Prometheus" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://team-manual.cloud.service.gov.uk/technical_design/prometheus/" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link" data-module="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="https://team-manual.cloud.service.gov.uk" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          PaaS Team Manual
        </span>
      </a>
        <strong class="govuk-tag">Internal</strong>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents" role="dialog">
              <div class="search" data-module="search" data-path-to-site-root="/">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://team-manual.cloud.service.gov.uk"/>
    <label class="govuk-label search__label" for="search" aria-hidden="true">
      Search (via Google)
    </label>
    <input
      type="text"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                      <ul>
  <li>
    <a href="#prometheus"><span>Prometheus</span></a>
    <ul>
      <li>
        <a href="#high-availability"><span>High availability</span></a>
        <ul>
          <li>
            <a href="#logging-in-to-grafana-2"><span>Logging in to grafana-2</span></a>
          </li>
        </ul>
      </li>
      <li>
        <a href="#alerting"><span>Alerting</span></a>
      </li>
      <li>
        <a href="#urls"><span>URLs</span></a>
        <ul>
          <li>
            <a href="#primary"><span>Primary</span></a>
          </li>
          <li>
            <a href="#secondary"><span>Secondary</span></a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled" aria-label="Content" tabindex="0">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              <div class="page-banner">
    <p>This is for internal use by the PaaS team. Public-facing documentation is located at <a href="https://docs.cloud.service.gov.uk">docs.cloud.service.gov.uk</a>.</p>
  </div>

  <h1 id="prometheus">Prometheus</h1>
<h2 id="high-availability">High availability</h2>
<p>All components run at least on two different VMs in different availability zones.</p>
<p>All Prometheus instances are independent and scrape the metrics endpoints separately. This means the Prometheus instances will have slightly different data (because of different scraping times). For various reasons (downtime, restart, etc.) one Prometheus instance might also have some data missing compared to the others.</p>
<p>All Prometheus instances will send alerts to all alertmanagers. The alertmanagers form a separate cluster and will deduplicate any identical alerts.</p>
<p>The Grafana instances will connect only to the Prometheus instance which is in the same availability zone.</p>
<p>All instances have a unique url, so in case of an AZ failure you can use the monitoring urls from the working AZ.</p>
<h3 id="logging-in-to-grafana-2">Logging in to <code>grafana-2</code></h3>
<p>Due to a quirk in how the Grafanas are provisioned, they both share the same Google auth client id, and so attempting to log in to <code>grafana-2</code> will cause the auth flow to be redirected back to <code>grafana-1</code> which will show an error. Simply changing URL in the address bar at this point back to the <code>grafana-2</code> equivalent address should allow authentication to succeed.</p>
<h2 id="alerting">Alerting</h2>
<p>Prometheus is configured to send alerts to teams mailing lists.</p>
<p>You can find these mailing lists <a href="/team/platform_alerting/">here</a>.</p>
<h2 id="urls">URLs</h2>
<h3 id="primary">Primary</h3>
<div class="table-container">
        <table>
          <tr>
<th>Ireland</th>
<th>UK</th>
</tr><tr>
<th scope="row"><a href="https://prometheus-1.cloud.service.gov.uk">prometheus-1.cloud.service.gov.uk</a>
</th>
<td><a href="https://prometheus-1.london.cloud.service.gov.uk">prometheus-1.london.cloud.service.gov.uk</a></td>
</tr><tr>
<th scope="row"><a href="https://alertmanager-1.cloud.service.gov.uk">alertmanager-1.cloud.service.gov.uk</a>
</th>
<td><a href="https://alertmanager-1.london.cloud.service.gov.uk">alertmanager-1.london.cloud.service.gov.uk</a></td>
</tr><tr>
<th scope="row"><a href="https://grafana-1.cloud.service.gov.uk">grafana-1.cloud.service.gov.uk</a>
</th>
<td><a href="https://grafana-1.london.cloud.service.gov.uk">grafana-1.london.cloud.service.gov.uk</a></td>
</tr>
        </table>
      </div><h3 id="secondary">Secondary</h3>
<div class="table-container">
        <table>
          <tr>
<th>Ireland</th>
<th>UK</th>
</tr><tr>
<th scope="row"><a href="https://prometheus-2.cloud.service.gov.uk">prometheus-2.cloud.service.gov.uk</a>
</th>
<td><a href="https://prometheus-2.london.cloud.service.gov.uk">prometheus-2.london.cloud.service.gov.uk</a></td>
</tr><tr>
<th scope="row"><a href="https://alertmanager-2.cloud.service.gov.uk">alertmanager-2.cloud.service.gov.uk</a>
</th>
<td><a href="https://alertmanager-2.london.cloud.service.gov.uk">alertmanager-2.london.cloud.service.gov.uk</a></td>
</tr><tr>
<th scope="row"><a href="https://grafana-2.cloud.service.gov.uk">grafana-2.cloud.service.gov.uk</a>
</th>
<td><a href="https://grafana-2.london.cloud.service.gov.uk">grafana-2.london.cloud.service.gov.uk</a></td>
</tr>
        </table>
      </div>

            
          </main>

          <aside>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="/accessibility/">Accessibility</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >Â© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="/javascripts/application.js"></script>
  </body>
</html>

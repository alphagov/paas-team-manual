<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>Tenant Application Penetration and Load Testing - PaaS Team Manual</title>

    <link href="../../stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://team-manual.cloud.service.gov.uk/guides/Tenant_Application_Penetration_Testing/">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="team-manual.cloud.service.gov.uk" />
      <meta name="twitter:image" content="https://team-manual.cloud.service.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="Tenant Application Penetration and Load Testing - PaaS Team Manual" />
      <meta name="twitter:url" content="https://team-manual.cloud.service.gov.uk/guides/Tenant_Application_Penetration_Testing/" />

      <meta property="og:image" content="https://team-manual.cloud.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="PaaS Team Manual" />
      <meta property="og:title" content="Tenant Application Penetration and Load Testing" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://team-manual.cloud.service.gov.uk/guides/Tenant_Application_Penetration_Testing/" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="https://team-manual.cloud.service.gov.uk" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          PaaS Team Manual
        </span>
      </a>
        <strong class="govuk-tag">Internal</strong>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <button type="button" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </button>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents" tabindex="-1" aria-label="Table of contents" role="dialog">
              <div class="search" data-module="search">
  <form action="https://www.google.co.uk/search" method="get" role="search" class="search__form govuk-!-margin-bottom-4">
    <input type="hidden" name="as_sitesearch" value="https://team-manual.cloud.service.gov.uk"/>
    <label class="govuk-label search__label" for="search" aria-hidden="true">
      Search (via Google)
    </label>
    <input
      type="text"
      id="search" name="q"
      class="govuk-input govuk-!-margin-bottom-0 search__input"
      aria-controls="search-results"
      placeholder="Search">
    <button type="submit" class="search__button">Search</button>
  </form>
</div>

              <button type="button" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></button>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                      <ul>
  <li>
    <a href="#tenant-application-penetration-and-load-testing"><span>Tenant Application Penetration and Load Testing</span></a>
    <ul>
      <li>
        <a href="#penetration-testing"><span>Penetration testing</span></a>
      </li>
      <li>
        <a href="#load-testing"><span>Load Testing</span></a>
      </li>
      <li>
        <a href="#find-penetration-testable-ec2-instance-ids"><span>Find penetration testable EC2 instance IDs</span></a>
      </li>
      <li>
        <a href="#find-elbs"><span>Find ELBs</span></a>
      </li>
      <li>
        <a href="#find-cloudfront-distributions"><span>Find CloudFront distributions</span></a>
      </li>
      <li>
        <a href="#find-external-ips-nat"><span>Find external IPs (NAT)</span></a>
      </li>
      <li>
        <a href="#find-rds-instances-from-a-given-org"><span>Find RDS instances from a given org</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              <div class="page-banner">
    <p>This is for internal use by the PaaS team. Public-facing documentation is located at <a href="https://docs.cloud.service.gov.uk">docs.cloud.service.gov.uk</a>.</p>
  </div>

  <h1 id="tenant-application-penetration-and-load-testing">Tenant Application Penetration and Load Testing</h1>
<h2 id="penetration-testing">Penetration testing</h2>
<p>We no longer have to notify AWS of penetration testing, however it is useful for the team to know that this is taking place and that we have contact details of the testers if issues arise during the testing window.</p>
<div class="table-container">
        <table>
          <tr>
<th>Name</th>
<th>Value</th>
</tr><tr>
<th scope="row">source_IP</th>
<td>Provided by penetration tester. The IPs that the test will originate from.</td>
</tr><tr>
<th scope="row">phone_for_testing_team</th>
<td>Provided by penetration tester. Phone number of the testers.</td>
</tr><tr>
<th scope="row">peak_bandwidth</th>
<td>Provided by penetration tester. The peak amount of bandwidth the tests will consume (Gbps).</td>
</tr><tr>
<th scope="row">peak_rps</th>
<td>Provided by penetration tester. The peak number of requests-per-second the tests will perform.</td>
</tr><tr>
<th scope="row">StartDate</th>
<td>Provided by penetration tester. When will the test start?  (eg. <code>2017-09-26T09:00:00Z</code> )</td>
</tr><tr>
<th scope="row">EndDate</th>
<td>Provided by penetration tester. When will the test end? (eg. <code>2017-09-26T18:00:00Z</code> )</td>
</tr><tr>
<th scope="row">can_you_stop</th>
<td>Provided by penetration tester. Once started, is it possible to stop the test immediately if there is an issue?</td>
</tr><tr>
<th scope="row">emergency_contact</th>
<td>Provided by penetration tester. Email and phone number in case issues arise.</td>
</tr>
        </table>
      </div><h2 id="load-testing">Load Testing</h2>
<p>Before allowing a load test against applications running on PaaS we may have to notify AWS. Currently we are not sure on the scenarios when we do not have to notify AWS. We are erring on the side of caution and notifying for all load tests.</p>
<p>There are two methods to notify AWS: <a href="https://aws.amazon.com/forms/penetration-testing-request">a form which requires root account access</a>, or, by emailing <code>aws-security-cust-pen-test@amazon.com</code>. Both require providing the following information:</p>
<div class="table-container">
        <table>
          <tr>
<th>Name</th>
<th>Value</th>
</tr><tr>
<th scope="row">AWS AccountId</th>
<td>Production account ID</td>
</tr><tr>
<th scope="row">SubmitterName</th>
<td>Your name</td>
</tr><tr>
<th scope="row">CompanyName</th>
<td><code>Government Digital Service</code></td>
</tr><tr>
<th scope="row">EmailAddress</th>
<td>Team email address</td>
</tr><tr>
<th scope="row">AdditionalEmail1</th>
<td>Optional</td>
</tr><tr>
<th scope="row">AdditionalEmail2</th>
<td>Optional</td>
</tr><tr>
<th scope="row">AdditionalEmail3</th>
<td>Optional</td>
</tr><tr>
<th scope="row">Customer_NDA</th>
<td><code>yes</code></td>
</tr><tr>
<th scope="row">ec2_resources</th>
<td>
<a href="#find-penetration-testable-ec2-instance-ids">EC2 resource IDs to be tested</a>.</td>
</tr><tr>
<th scope="row">cloudfront_ID</th>
<td>
<a href="#find-cloudfront-distributions">CloudFront distribution IDs to be tested</a>.</td>
</tr><tr>
<th scope="row">api_gateway</th>
<td>N/A</td>
</tr><tr>
<th scope="row">rds_resources</th>
<td>N/A</td>
</tr><tr>
<th scope="row">elb_resources</th>
<td>
<a href="#find-elbs">ELB hostnames to be tested</a>.</td>
</tr><tr>
<th scope="row">external_IPs</th>
<td>N/A</td>
</tr><tr>
<th scope="row">nameserver_info</th>
<td>N/A</td>
</tr><tr>
<th scope="row">dns_owner_notified</th>
<td>N/A</td>
</tr><tr>
<th scope="row">TLD_scanned</th>
<td>N/A</td>
</tr><tr>
<th scope="row">source_IP</th>
<td>Provided by tester. The IPs that the test will originate from.</td>
</tr><tr>
<th scope="row">on_prem</th>
<td>Provided by tester. Will the requests originate from the office of the testers?</td>
</tr><tr>
<th scope="row">third_party</th>
<td>Provided by tenant. Are the testers a third-party company?</td>
</tr><tr>
<th scope="row">phone_for_testing_team</th>
<td>Provided by tester. Phone number of the testers.</td>
</tr><tr>
<th scope="row">testing_company_NDA</th>
<td>Provided by tester. Has an NDA with AWS been signed by the penetration testers?</td>
</tr><tr>
<th scope="row">peak_bandwidth</th>
<td>Provided by tester. The peak amount of bandwidth the tests will consume (Gbps).</td>
</tr><tr>
<th scope="row">peak_rps</th>
<td>Provided by tester. The peak number of requests-per-second the tests will perform.</td>
</tr><tr>
<th scope="row">dns_walking_qps</th>
<td>N/A</td>
</tr><tr>
<th scope="row">StartDate</th>
<td>Provided by tester. When will the test start?  (eg. <code>2017-09-26T09:00:00Z</code> )</td>
</tr><tr>
<th scope="row">EndDate</th>
<td>Provided by tester. When will the test end? (eg. <code>2017-09-26T18:00:00Z</code> )</td>
</tr><tr>
<th scope="row">testing_details</th>
<td>Provided by tenant. Why is the test being carried out? What is the test covering?</td>
</tr><tr>
<th scope="row">metrics_of_test</th>
<td>Provided by tester. What metrics are being measured in order to decide the success or failure of the test?</td>
</tr><tr>
<th scope="row">can_you_stop</th>
<td>Provided by tester. Once started, is it possible to stop the test immediately if there is an issue?</td>
</tr><tr>
<th scope="row">emergency_contact</th>
<td>Provided by tester. Email and phone number in case issues arise.</td>
</tr>
        </table>
      </div><h2 id="find-penetration-testable-ec2-instance-ids">Find penetration testable EC2 instance IDs</h2>
<p>AWS only allows penetration tests on instances of certain sizes. You can find all valid instances with the following:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>aws ec2 describe-instances \
| jq '.Reservations[].Instances[] | select(.InstanceType != "t2.nano" and .InstanceType != "t1.micro" and .InstanceType != "m1.small") | .InstanceId' --raw-output
</code></pre></div><h2 id="find-elbs">Find ELBs</h2>
<p>For tenant application penetration testing it should only be necessary to provide the router ELB:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>aws elb describe-load-balancers \
| jq '.LoadBalancerDescriptions[] | select(.Scheme == "internet-facing") | select(.LoadBalancerName | endswith("-router")) | .DNSName' --raw-output
</code></pre></div><h2 id="find-cloudfront-distributions">Find CloudFront distributions</h2>
<p>The <code>cdn-route</code> service uses a CloudFront distribution. You can discover these distributions with the following:</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>aws cloudfront list-distributions \
| jq '.DistributionList.Items[] | select(.Comment == "cdn route service") | .Id' --raw-output
</code></pre></div><h2 id="find-external-ips-nat">Find external IPs (NAT)</h2>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code>aws ec2 describe-nat-gateways | jq -r '.NatGateways[].NatGatewayAddresses[].PublicIp
</code></pre></div><h2 id="find-rds-instances-from-a-given-org">Find RDS instances from a given org</h2>
<p>Assuming you are logged in the production CF and <code>AWS_DEFAULT_REGION</code> set to the right region</p>
<div class="highlight"><pre class="highlight plaintext" tabindex="0"><code># AWS_DEFAULT_REGION=eu-west-1

ORG=tenant-org

account_id="$(aws sts get-caller-identity --output text  --query Account)"
rds_services="$(cf curl /v2/services | jq '[ .resources[] | select(.entity.service_broker_name == "rds-broker") | .metadata.guid ]')"

cf curl /v2/service_instances?q=organization_guid:$(cf org --guid $ORG) | \
    jq -r \
        --argjson rds_services "${rds_services}" \
        --arg aws_default_region "${AWS_DEFAULT_REGION}" \
        --arg account_id "${account_id}" \
        '
        .resources[] |
            select([.entity.service_guid] | inside($rds_services)) |
            "arn:aws:rds:\($aws_default_region):\($account_id):db:rdsbroker-\(.metadata.guid)"
        '
</code></pre></div>

            
          </main>

          <aside>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="../../accessibility/">Accessibility</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="../../javascripts/application.js"></script>
  </body>
</html>

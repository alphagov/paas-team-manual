<!doctype html>
<html lang="en" class="govuk-template no-js">
  <head>
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

    <title>PaaS Team Manual</title>

    <link href="../../stylesheets/manifest.css" rel="stylesheet" />

    <link rel="canonical" href="https://team-manual.cloud.service.gov.uk/guides/CloudFoundry_debugging/">

      <meta name="twitter:card" content="summary" />
      <meta name="twitter:domain" content="team-manual.cloud.service.gov.uk" />
      <meta name="twitter:image" content="https://team-manual.cloud.service.gov.uk/images/govuk-large.png" />
      <meta name="twitter:title" content="PaaS Team Manual" />
      <meta name="twitter:url" content="https://team-manual.cloud.service.gov.uk/guides/CloudFoundry_debugging/" />

      <meta property="og:image" content="https://team-manual.cloud.service.gov.uk/images/govuk-large.png" />
      <meta property="og:site_name" content="PaaS Team Manual" />
      <meta property="og:type" content="object" />
      <meta property="og:url" content="https://team-manual.cloud.service.gov.uk/guides/CloudFoundry_debugging/" />

    
  </head>

  <body class="govuk-template__body">
    <script>document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');</script>

    <div class="app-pane">
      <div class="app-pane__header toc-open-disabled">
        <a href="#content" class="govuk-skip-link">Skip to main content</a>

        <header class="govuk-header app-header" role="banner" data-module="govuk-header">
  <div class="govuk-header__container govuk-header__container--full-width">
    <div class="govuk-header__logo">
      <a href="https://team-manual.cloud.service.gov.uk" class="govuk-header__link govuk-header__link--homepage">
        <span class="govuk-header__product-name">
          PaaS Team Manual
        </span>
      </a>
        <strong class="govuk-tag">Internal</strong>
    </div>
  </div>
</header>

      </div>

        <div id="toc-heading" class="toc-show fixedsticky">
          <a href="#toc" class="toc-show__label js-toc-show" aria-controls="toc">
            Table of contents <span class="toc-show__icon"></span>
          </a>
        </div>

      <div class="app-pane__body" data-module="in-page-navigation">
          <div class="app-pane__toc">
            <div class="toc" data-module="table-of-contents">
              
              <a href="#" class="toc__close js-toc-close" aria-controls="toc" aria-label="Hide table of contents"></a>
              <nav id="toc" class="js-toc-list toc__list" aria-labelledby="toc-heading">
                      <ul>
  <li>
    <a href="#cloud-foundry-debugging"><span>Cloud Foundry debugging</span></a>
    <ul>
      <li>
        <a href="#finding-which-cell-an-app-instance-is-running-on"><span>Finding which cell an app instance is running on</span></a>
      </li>
      <li>
        <a href="#downloading-an-app-container"><span>Downloading an app container</span></a>
      </li>
    </ul>
  </li>
</ul>


              </nav>
            </div>
          </div>

        <div class="app-pane__content toc-open-disabled">
          <main id="content" class="technical-documentation" data-module="anchored-headings">
              <div class="page-banner">
    <p>This is for internal use by the PaaS team. Public-facing documentation is located at <a href="https://docs.cloud.service.gov.uk">docs.cloud.service.gov.uk</a>.</p>
  </div>

  <h1 id="cloud-foundry-debugging">Cloud Foundry debugging</h1><p>This is a set of useful things that may help you debug CloudFoundry problems.</p>
<h2 id="finding-which-cell-an-app-instance-is-running-on">Finding which cell an app instance is running on</h2><p>First, get the GUID of the app you want to investigate:
<code>
$ cf app APPNAME --guid
c6d1259c-8057-489e-9ac2-beaa896c2bf3
</code></p>
<p>Then use <code>cf curl</code> and <code>jq</code> to extract the information from the stats endpoint:
<code>
$ cf curl /v2/apps/c6d1259c-8057-489e-9ac2-beaa896c2bf3/stats | jq &#39;with_entries(.value = .value.stats.host)&#39;
{
  &quot;0&quot;: &quot;10.0.33.4&quot;,
  &quot;1&quot;: &quot;10.0.34.4&quot;
}
</code></p>
<p>You can use <code>bosh vms</code> to correlate the IPs to BOSH job indexes or VM UUIDs.</p>
<h2 id="downloading-an-app-container">Downloading an app container</h2><p>If there are problems running an app then <code>cf files</code> will not function as the container must be running. An alternative is to grab the droplet image directly from CloudFoundry and unpack it locally. This can also be useful when you need to obtain a copy of a deployed app if you don&rsquo;t have the source.</p>
<p>First, get the GUID of the app you want to investigate:
<code>
$ cf app APPNAME --guid
5ffab66f-0be2-4a65-b9ff-40a902a05b50
</code></p>
<p>Then use the <code>cf curl</code> wrapper to make an API call that retrieves the droplet and unpack it:
<code>
$ mkdir droplet &amp;&amp; cd droplet
$ cf curl /v2/apps/5ffab66f-0be2-4a65-b9ff-40a902a05b50/droplet/download &gt; image.tar.gz
$ tar -zxf image.tar.gz
</code></p>
<p><strong>Note:</strong> Tar will exit complaining about invalid gzip blocks - this is because the droplet has other data (such as a signature) appended to the end of the image. This isn&rsquo;t a problem, all the files for the image will be unpacked anyway.</p>
<p>You should now have everything used to run the app and all the build logs. <code>app</code> contains everything the user <code>cf push</code>-ed plus any change from the staging phase (for example, compiled binaries):
<code>
$ ls -lah
total 41M
drwxr-xr-x  5 ubuntu ubuntu 4.0K Dec  9 11:55 .
drwxr-xr-x 23 ubuntu ubuntu 4.0K Dec  8 19:43 ..
drwxr--r-- 10 ubuntu ubuntu 4.0K Dec  8 16:04 app
-rw-rw-r--  1 ubuntu ubuntu  41M Dec  8 13:41 image.tar.gz
drwxr-xr-x  2 ubuntu ubuntu 4.0K Dec  8 13:53 logs
-rw-r--r--  1 ubuntu ubuntu  298 Dec  8 13:27 staging_info.yml
drwxr-xr-x  2 ubuntu ubuntu 4.0K Dec  8 13:27 tmp
</code></p>


            
          </main>

          <aside>
          </aside>

          <footer class="govuk-footer app-footer" role="contentinfo">
  <div class="govuk-footer__meta">
    <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

        <ul class="govuk-footer__inline-list">
            <li class="govuk-footer__inline-list-item">
              <a class="govuk-footer__link" href="../../accessibility/">Accessibility</a>
            </li>
        </ul>

      <svg
        aria-hidden="true"
        focusable="false"
        class="govuk-footer__licence-logo"
        xmlns="http://www.w3.org/2000/svg"
        viewbox="0 0 483.2 195.7"
        height="17"
        width="41"
      >
        <path
          fill="currentColor"
          d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145"
        />
      </svg>
      <span class="govuk-footer__licence-description">
        All content is available under the
        <a
          class="govuk-footer__link"
          href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
          rel="license"
        >Open Government Licence v3.0</a>, except where otherwise stated
      </span>
    </div>
    <div class="govuk-footer__meta-item">
      <a
        class="govuk-footer__link govuk-footer__copyright-logo"
        href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/"
      >Â© Crown copyright</a>
    </div>
  </div>
</footer>

        </div>
      </div>
    </div>

    
    <script src="../../javascripts/application.js"></script>
  </body>
</html>

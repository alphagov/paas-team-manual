<h1 id="how-to-disable-a-single-az-on-gov-uk-paas">How to disable a single AZ on GOV.UK PaaS</h1><p>There are scenarios, where we will need to manually disable a single AZ on AWS,
prompting the cells, traffic, scheduler and auctioneer to redistribute the
applications across the remaining AZs.</p>
<p>Scenario like this may be when we see an AZ being flappy in network connectivity
terms.</p>
<p>We&rsquo;ve developed a way, to accomplish that, with either your dev machine and
Terraform, or simply running the appropriate Concourse job.</p>
<p><a href="https://github.com/alphagov/paas-cf/tree/main/terraform/az-management">The <code>paas-cf</code> repository</a> contains a terraform module, which will deny all
traffic, to subnets in one particular AZ.</p>
<p>It also has a Concourse jobs, in <code>create-cloudfoundry</code> pipeline, and the
<code>operator</code> groups, to bot disable and enable particular AZs.</p>
<p><em>Please note</em>: Disabling the AZ <code>a</code>, will likely bring the Concourse down,
meaning the re-enabling action will need to be done by hand from op&rsquo;s machine.</p>
<p>This will involve, you having to download the Terraform state file, for that
particular region. See pipeline for more details.</p>
<h2 id="how-to-run">How to run</h2><p>This is accomplished with Terraform. It is designed, to interacively ask for the
values it needs, so you don&rsquo;t have to remember to set them at all times.</p>
<p>The values it is asking for are:
- AZ - <code>eu-west-1a</code>, <code>eu-west-1b</code>, <code>eu-west-1c</code>
- Region - <code>eu-west-1</code>
- VPC ID - <code>vpc-1234567890</code></p>
<p>The following will disable an AZ:</p>
<div class="highlight"><pre class="highlight shell" tabindex="0"><code>terraform apply
</code></pre></div><p>The following will re-enable an AZ:</p>
<div class="highlight"><pre class="highlight shell" tabindex="0"><code>terraform destroy
</code></pre></div>